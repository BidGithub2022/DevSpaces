schemaVersion: 2.2.0
metadata:
  name: my-web-app-devfile

components:
  - name: web
    container:
      image: registry.redhat.io/devspaces/udi-rhel8
      endpoints:
        - name: web
          targetPort: 80

  - name: db
    container:
      image: registry.redhat.io/rhel8/postgresql-12
      env:
        - name: POSTGRES_PASSWORD
          value: mysecretpassword
      volumeMounts:
        - name: postgres-data
          path: /var/lib/postgresql/data
      endpoints:
        - name: postgres
          targetPort: 5432  # Default PostgreSQL port
      command: ["/bin/sh"]
      args: ["-c", "yum -y install postgresql-server && /usr/bin/postgresql-setup --initdb && pg_ctl -D /var/lib/pgsql/data start"]


  - name: postgres-data
    volume:
      size: 1Gi

commands:
  - id: run-services
    exec:
      component: web  
      commandLine: docker-compose up 
      group:
        kind: run
