schemaVersion: 2.2.0
metadata:
  name: my-data-platform-devfile

components:
  - name: zookeeper
    container:
      image: confluentinc/cp-zookeeper:latest
      env:
        - name: ZOOKEEPER_CLIENT_PORT
          value: "2181" 
        - name: ZOOKEEPER_TICK_TIME
          value: "2000"
      endpoints:
        - name: zookeeper
          targetPort: 2181

  - name: kafka
    container:
      image: confluentinc/cp-kafka:latest
      env:
        - name: KAFKA_BROKER_ID
          value: "1"
        - name: KAFKA_ZOOKEEPER_CONNECT
          value: "zookeeper:2181"
        - name: KAFKA_LISTENER_SECURITY_PROTOCOL_MAP
          value: "PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT"
        - name: KAFKA_ADVERTISED_LISTENERS
          value: "PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:9092"
        - name: KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR
          value: "1"
      endpoints:
        - name: kafka
          targetPort: 9092

  - name: redis
    container:
      image: registry.connect.redhat.com/redislabs/redis-enterprise
      endpoints:
        - name: redis
          targetPort: 6380
      command: ['chmod', '+x', '/opt/start.sh']
      command: ['chmod', '+x', '/opt/redislabs/sbin/supervisord_prestart_script.sh']

commands:
  - id: run-services
    exec:
      component: zookeeper  
      commandLine: docker-compose up 
      group:
        kind: run

